<div class="well" id="menu_font" style="font-size: 20px;" >
  <center><%=@date.to_date.year%>년 <%=@date.to_date.month%>월 <%=@date.to_date.day%>일<br><%=@class.building_name%> '<%=@class.room_number%>호'에 대한 예약현황입니다.
  <br><a href="/book/booking?id=<%=@class.id%>&date=<%=@date%>" class="btn btn-warning" id="menu_font" style="font-size: 20px;">예약하기</a></center>
</div>
<br>

<div class="containter"> 
<div class="row">

<div class="col-md-3 col-md-offset-1">
    <div class="panel panel-info">
      <div class="panel-heading">
        <div class="panel-title" style="text-align: center; font-size: 20px;" id="menu_font"><center>예약 현황을 볼 날짜를 선택해라</center></div>
      </div>
      <div class="panel-body">
        <center>
        <div class="well">
          <form action="/book/view_booking" method="POST">
            <input type="date" name="show_date" style="text-align: center; font-size: 20px;" id="menu_font" required> 
            <input type="hidden" name="id" style="text-align: center; font-size: 18px;" id="menu_font" value="<%=@class.id%>"> 
            <button type="submit"class="btn btn-primary btn-sm" style="text-align: center; font-size: 18px;" id="menu_font">날짜 검색</button>
          </form>
        </div>
         </center>
      </div>
       
    </div>
  </div>

  
 


<div class="col-md-7 col-md-offset-0">
  <table class="table table-striped table-hover ">
    <thead>
      <tr class="info" style="text-align: center; font-size: 20px;" id="menu_font_t">
        
        <th>사용자 이름</th>
        <!--<th>사용날짜</th>-->
        <th>사용날짜 및 시간</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @class.reservations.where(date: @date).order(:start_time).each do |c| %>
          <tr>
           
            <td style="font-size: 18px;" id="menu_font"><%=User.find(c.user).email %></td>
           <!--<td><%#=c.date%></td>-->
            <td style="font-size: 18px;" id="menu_font"><%=c.start_time.to_s(:db)%> ~ <%=c.finish_time.to_s(:db)%></td>

            <td style="font-size: 18px;" id="menu_font">
              <% if current_user %> <!--로그인 된 상태.-->
                        
                      <%  if current_user.email == "admin@ptu.ac.kr" %> <!--관리자일때 승인하기-->
                        <span class="label label-info" id="view_state<%c.id%>"><%=c.state%></span>
                        
                            <% if c.state=="승인대기" %>
                              <button type="button" class="btn btn-primary btn-sm" id="button<%=c.id%>" onclick="change()" 
                              style="text-align: center; font-size: 16px;" id="menu_font">승인하기</button>
                            <% else %>
                              <button type="button" class="btn btn-primary btn-sm" id="button<%=c.id%>" onclick="change()"
                              style="text-align: center; font-size: 16px;" id="menu_font">승인취소</button>
                              <input class="btn btn-primary btn-sm" onclick="change()" value="승인하기" id="<=c.id%>"
                              style="text-align: center; font-size: 16px;" id="menu_font"></input>
                            <%end%>
                                      
                      <% else %> <!--관리자가 아닐때 승인대기-->
                        <span class="label label-info" style="text-align: center; font-size: 16px;" id="menu_font"><%=c.state%></span><!--관리자가 아닐땐 상태만 보여준다-->
                        <input class="btn btn-primary btn-sm" value="승인대기" id="<=c.id%>"></input>
                                  
                      <% end %>
                                   
               <% end %> <!-- if current_user end -->
                    
<script>
   function change(){                             
// $(function() {  
                                	     
  // $("#button%=c.id%>").click(function change(){                 

    var view_state = document.getElementById("view_state<%=c.id%>");
    var button = document.getElementById("button<%=c.id%>");
    alert("view_state<%=c.id%>  ;  button<%=c.id%>"  );
      <% if c.state == "승인대기" %> 
      // 승인대기상태라면 버튼눌렀을때 승인완료로 바뀜
        <% @state_change=Reservation.find(c.id)
           @state_change.state="승인완료"
           @state_change.save %> //db에 저장
           
           view_state.innerHTML="<%=c.state%>"; //상태표시를 바꿔줌
           button.innerHTML="승인취소"; //버튼의값을 일시적으로 바꿔줌
           
      <% else %>//승인취소시
        <% @state_change=Reservation.find(c.id)
           @state_change.state="승인대기"
           @state_change.save %> //db에 저장
           
           view_state.innerHTML="<%=c.state%>"; //상태표시를 바꿔줌
           button.innerHTML="승인하기"; //버튼의값을 일시적으로 바꿔줌
      <%end%>
  // });
};
</script>
            </td>
               
            <td><button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#show<%=c.id%>"
            style="text-align: center; font-size: 16px;" id="menu_font">상세보기</button></td>
            
            <td>
            <% if current_user %>
                       <% if User.find(c.user).email == current_user.email %>
                        <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#show_check<%=c.id%>" 
                        style="text-align: center; font-size: 16px;" id="menu_font">예약취소</button>
                       <% else %>
                         
                       <%end%>
                <% else %>
                
                <% end %>
            </td>
          </tr>

      <% end %>
    </tbody>
  </table> 
</div>
</div> <!--row의 div>


<% @class.reservations.where(date: @date).each do |c| %><!--예약취소 모달-->

<div id="show_check<%=c.id%>" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">예약 취소</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="recipient-name" class="control-label">예약을 취소하시겠습니까?</label>
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <form action="/book/delete/<%=c.id%>" method="POST">
              <button type="submit" class="btn btn-primary">취소하기</button>
            </form>
      </div>
      </div>
    </div>
  </div>
</div>


      
          
<div id="show<%=c.id%>" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"><!--예약상세보기-->
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel"> 예약 상세 보기</h4>
      </div>
      <div class="modal-body">
        
        <div class="form-group">
          <label for="recipient-name" class="control-label">사용자</label>
          <%=c.user%>
        </div>
        
        
        <div class="form-group">
          <label for="recipient-name" class="control-label">사용시간</label>
          <%=c.start_time.to_s(:db)%> ~ <%=c.finish_time.to_s(:db)%>
        </div>
        
        <div class="form-group">
          <label for="recipient-name" class="control-label">사용목적</label>
          <%=c.purpose%>
        </div>
        
        <div class="form-group">
          <label for="recipient-name" class="control-label">담당 교수</label>
          <%=c.professor%>            
        </div>
      </div>
      
      
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      <% if current_user.email == "admin@ptu.ac.kr" %>
        <button type="button" class="btn btn-primary" id = "ok" >승인하기</button>
      <% end %>  

      </div>
    </div>
  </div>
</div>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<%end%>


</div>


